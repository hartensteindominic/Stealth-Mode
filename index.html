<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>InfinityNode One-File Blockchain</title>
    <style>
        :root { --glow: #00ecff; --bg: #050505; }
        body { background: var(--bg); color: #888; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; padding: 20px; }
        .terminal { background: #111; border: 1px solid #222; width: 100%; max-width: 800px; padding: 30px; border-radius: 8px; box-shadow: 0 20px 50px rgba(0,0,0,0.7); }
        h1 { color: var(--glow); text-align: center; letter-spacing: 3px; font-weight: 300; }
        .box { background: #000; border-left: 3px solid var(--glow); padding: 15px; margin: 15px 0; font-family: monospace; font-size: 0.9em; overflow-wrap: break-word; }
        input { width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #333; color: white; margin-top: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; margin-top: 15px; border: none; cursor: pointer; font-weight: bold; letter-spacing: 1px; transition: 0.3s; }
        .btn-mine { background: var(--glow); color: #000; }
        .btn-gen { background: #333; color: #fff; }
        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 20px; text-align: center; }
        .stat-val { display: block; color: var(--glow); font-size: 1.5em; font-weight: bold; }
        #log { height: 120px; overflow-y: auto; background: #000; padding: 10px; margin-top: 20px; border: 1px solid #222; font-size: 0.8em; color: #555; }
    </style>
</head>
<body>

<div class="terminal">
    <h1>INFINITY-CHAIN v1.0</h1>

    <button class="btn-gen" onclick="generateWallet()">1. GENERATE NEW GLOBAL IDENTITY</button>
    
    <div id="walletArea" style="display:none">
        <div class="box"><strong>PUBLIC ADDRESS:</strong><br><span id="pub"></span></div>
        <div class="box" style="border-color: #ff3e3e"><strong>PRIVATE KEY:</strong><br><span id="priv"></span></div>
    </div>

    <input type="text" id="target" placeholder="Paste Public Address Here">
    <button class="btn-mine" id="mineBtn" onclick="toggleMining()">2. LAUNCH MINING ENGINE</button>

    <div class="stats">
        <div><span class="stat-val" id="balance">0</span>Balance</div>
        <div><span class="stat-val" id="blocks">0</span>Blocks Found</div>
        <div><span class="stat-val" id="hashrate">0</span>H/s</div>
    </div>

    <div id="log">> System initialized. Waiting for command...</div>
</div>

<script id="worker-code" type="javascript/worker">
    self.onmessage = async function(e) {
        const { wallet, difficulty } = e.data;
        let nonce = 0;

        async function sha256(str) {
            const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
            return Array.prototype.map.call(new Uint8Array(buf), x => (('00' + x.toString(16)).slice(-2))).join('');
        }

        while (true) {
            nonce++;
            const hash = await sha256(wallet + nonce);
            if (hash.startsWith('0'.repeat(difficulty))) {
                self.postMessage({ type: 'SUCCESS', hash, nonce });
            }
            if (nonce % 2000 === 0) self.postMessage({ type: 'TICK' });
        }
    };
</script>

<script>
    let isMining = false;
    let worker;
    let hashes = 0;
    let start;

    function log(msg) {
        const l = document.getElementById('log');
        l.innerHTML += `<div>> ${msg}</div>`;
        l.scrollTop = l.scrollHeight;
    }

    async function generateWallet() {
        const entropy = window.crypto.getRandomValues(new Uint8Array(32));
        const priv = Array.from(entropy, b => b.toString(16).padStart(2, '0')).join('');
        const hashBuf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(priv));
        const pub = "INF_" + Array.from(new Uint8Array(hashBuf)).map(b => b.toString(16).padStart(2, '0')).join('').substring(0, 20);
        
        document.getElementById('pub').innerText = pub;
        document.getElementById('priv').innerText = priv;
        document.getElementById('target').value = pub;
        document.getElementById('walletArea').style.display = 'block';
        log("Identity encrypted and stored in local memory.");
    }

    function toggleMining() {
        const wallet = document.getElementById('target').value;
        const btn = document.getElementById('mineBtn');
        if (!wallet) return alert("Enter address!");

        if (!isMining) {
            isMining = true;
            btn.innerText = "SHUTDOWN ENGINE";
            btn.style.background = "#ff3e3e";
            start = Date.now();
            
            const blob = new Blob([document.getElementById('worker-code').textContent], {type: 'text/javascript'});
            worker = new Worker(window.URL.createObjectURL(blob));
            
            worker.onmessage = (e) => {
                if (e.data.type === 'SUCCESS') {
                    document.getElementById('blocks').innerText = parseInt(document.getElementById('blocks').innerText) + 1;
                    log(`BLOCK FOUND: ${e.data.hash.substring(0,16)}...`);
                    saveToCloud(wallet, e.data.hash);
                } else {
                    hashes += 2000;
                    document.getElementById('hashrate').innerText = Math.floor(hashes / ((Date.now() - start)/1000));
                }
            };
            worker.postMessage({ wallet, difficulty: 4 });
            log("Mining engine engaged.");
        } else {
            isMining = false;
            worker.terminate();
            btn.innerText = "LAUNCH MINING ENGINE";
            btn.style.background = "#00ecff";
            log("Engine offline.");
        }
    }

    // This is the "Legit" part: Saving to a public record
    function saveToCloud(wallet, hash) {
        // In a real crypto, this would be a POST to a P2P node.
        // For a one-file HTML, we simulate the ledger update.
        let balance = parseInt(document.getElementById('balance').innerText);
        document.getElementById('balance').innerText = balance + 10;
        
        // OPTIONAL: Integrate a service like jsonbin.io here to make it global
        log("Block recorded to local ledger.");
    }
</script>
</body>
</html>
